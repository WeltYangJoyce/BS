## 1. 引言

### 1.1 编写目的

本设计文档用于阐述图片管理网站的整体设计方案，包括系统架构、功能设计、数据库设计、接口设计、流程设计以及部署方案。文档供课程教师、评审人员和后续开发者参考。

### 1.2 项目背景

本项目为《BS体系软件设计》课程大程，通过 React + Flask + SQLite 技术栈实现一个可在 PC 与移动端使用的图片管理与展示系统，支持上传、分类、查询、展示、编辑及增强的 AI 标签功能。

### 1.3 术语说明

- **EXIF**：图片的元数据格式，用于存储拍摄时间、位置、分辨率等信息。
- **API**：应用程序接口（Application Programming Interface）。
- **MCP**：模型调用协议接口，用于与大模型交互。

------

## 2. 需求分析

### 2.1 功能需求

1. 用户注册与登录，包括用户名和 Email 的唯一性验证、密码强度判断。
2. 图片上传（支持来自 PC 和移动端）。
3. 自动解析 EXIF 信息并生成标签，如拍摄时间、地点、分辨率等。
4. 用户可添加自定义标签。
5. 自动生成图片缩略图。
6. 图片元数据保存在 SQLite 数据库中。
7. 支持多条件查询，包括标签、时间、地点等。
8. 提供友好展示界面，例如轮播模式。
9. 支持基础图片编辑：裁剪、色调调整。
10. 支持删除图片功能。
11. 前端适配移动端浏览器。
12. 增强功能（可选）：AI 标签识别、MCP 对话检索。

### 2.2 非功能需求

- **性能**：上传响应时间合理，缩略图生成稳定。
- **安全性**：使用加密技术保护用户密码，接口需 Token 验证。
- **可扩展性**：模块化结构易于扩展 AI 功能。
- **可维护性**：前后端分离架构，清晰模块划分。

------

## 3. 总体设计

### 3.0 页面与访问逻辑概述

本系统采用 Token 鉴权方式，所有访问主页面的用户在进入网站前均需检查本地是否存有有效 Token。若无 Token 或 Token 已过期，将强制跳转至登录页面；若 Token 有效，则可直接进入主页面。该设计提升了系统整体安全性和用户体验，避免未授权访问系统资源。

### 3.1 登录与注册页面设计

- 登录页面采用简洁风格设计，用户通过 **user_id** 与 **password** 完成登录。
- 若用户没有账号，可点击 register 按钮进入注册页面。
- 注册页面提供 **username、email、password** 三个字段，并进行格式与唯一性验证。
- 注册成功后自动跳转回登录页面，引导用户完成首次登录。

### 3.2 主页面布局设计

主页面分为 **上、中、下三层布局**，满足展示与交互并重的需求：

#### （1）上层：顶栏（Top Bar）

- 包含 **搜索栏** 与 **用户头像入口**。
- 用户可在搜索栏输入关键词进行图片检索，支持智能补全（可扩展）。
- 点击头像可进入用户中心页；若头像为空则展示默认头像。

#### （2）中层：轮播区域（Carousel）

- 用于播放重要通知、图片精选及系统推荐内容。
- 通知型卡片点击后跳转到通知详情页面。
- 图片型卡片点击后打开该图片的大图展示页。

#### （3）下层：图片展示区（Gallery）

- 展示所有用户上传的图片缩略图（缩略图由后端生成）。
- 支持两种排序方式：
  - **时间排序**：按上传时间展示最新内容。
  - **热度排序**：根据点赞数、浏览数等综合指标排序（算法在后端实现，可扩展）。
- 点击任意缩略图可展开大图页面，并可对图片进行点赞。

### 3.3 用户中心页面设计

用户中心页面包含四大功能部分：

1. **个人信息管理**：支持修改用户名、邮箱、简介，并上传头像。
2. **图片管理**：用户可上传新图片、查看已有上传记录，执行编辑、删除操作。
3. **历史记录**：包括浏览历史、点赞历史、上传历史与统计信息（如被点赞次数）。
4. **账号登出（Log Out）**：清除本地 Token 并返回登录界面。

------

### 3.4 系统架构

系统采用典型 BS 架构，包括：

- **前端：采用React、React Router、TailwindCSS构建 SPA 界面，使用 Axios 与后端通信。**
  - **React**：组件化思想清晰，生态成熟，学习曲线适中，便于快速构建单页应用（SPA）。React 的虚拟 DOM 可以在大量图片缩略图展示时减少 DOM 操作成本，提升渲染性能；同时与主流 UI 库（如 Tailwind、Ant Design）集成容易，可快速实现响应式移动端适配。
  - **React Router**：用于客户端路由管理，支持多视图和路由守卫，便于实现图片详情页、用户中心等单页路由切换体验。
  - **TailwindCSS**：实用类优先的 CSS 框架，能显著提高样式开发效率并保持一致的 UI 风格，同时方便实现响应式设计，减小自写样式量，利于课程周期内快速交付。
  - **Axios**：Promise 风格的 HTTP 客户端，API 请求与错误处理写法统一，便于在 React 中封装请求库（加 Token、重试、拦截器等）。
- **后端：Python Flask、Flask-CORS、Flask-JWT-Extended**
  - **Flask**：轻量级微框架，入门简单、扩展灵活，适合课程项目与快速原型开发。Flask 能让我们把精力集中在 API 设计与业务逻辑上，而不是框架复杂性上。对于本作业的需求（CRUD、文件上传、图像处理），Flask 足够且生态（如扩展库）完善。
  - **Flask-CORS**：允许前后端分离开发时跨域调用 API，方便前端本地调试与部署。
  - **Flask-JWT-Extended**（或类似库）：用于实现基于 JWT 的认证与会话管理，便于移动端与前端共享 Token 登录态。
- **图像处理与 EXIF 解析：Pillow、ExifRead / piexif**
  - **Pillow**：Python 标准的图像处理库，支持缩放、裁剪、颜色调整等操作，API 简洁，能满足缩略图生成与简单编辑功能。
  - **ExifRead / piexif**：解析并读取 JPEG 等图片的 EXIF 元数据，提取拍摄时间、GPS 信息等，二者都有良好文档与稳定性。
- **数据库：SQLite**
  - **SQLite**：零配置、文件型数据库，便于提交作业（只需包含 .db 文件或建表脚本），同时对单用户或小并发场景性能良好。课程要求建议使用 mysql 或文件型嵌入式数据库，SQLite 是符合该建议且部署最简单的选择；后期若需扩展到生产，可较容易迁移到 MySQL。
  - **文件存储**：本地存储原图与缩略图。
- **AI 模块（可选）：CLIP / 轻量化视觉模型 / 调用云端 API**
  - 若实现自动标签功能，可选用 CLIP 等视觉语义模型以获取图像的语义特征并生成标签；或在资源有限时调用公开的图像识别 API 进行标签推断。选用哪种方案将在资源与时间许可下决定（本设计文档保留扩展接口规范）。
- **开发与部署：Git、Docker、Docker Compose**
  - **Git**：版本控制与作业提交（包含 git log）要求中已明确，方便代码管理与审阅。
  - **Docker / Docker Compose**：保证开发环境与教师测试环境一致，便于一键部署。虽然 SQLite 不需要独立数据库容器，但 Docker 能规范后端运行环境（Python 依赖、环境变量等），并在需要时方便替换为 MySQL。
- **其他工具**
  - **Node.js（仅用于前端构建）**：用于构建 React 项目并生成静态资源。
  - **Nginx（可选）**：生产部署时可作为静态资源服务器或反向代理，提升静态文件分发性能。

以上技术选型基于课程项目的需求（易实现、易提交、低运维成本、良好扩展性）进行权衡，既能保证在有限时间内完成主要功能，也为后续集成 AI 或扩展为生产级应用留有空间。

------

## 4. 详细设计

本章节对各功能模块的内部逻辑、输入输出、核心流程进行简要设计说明，提供清晰的开发指导。

### 4.1 用户管理模块

用户管理模块负责处理注册、登录、认证与用户信息维护。用户注册时需验证用户名与邮箱唯一性，并使用 bcrypt 对密码进行加密。登录成功后生成 JWT Token 用于后续接口鉴权。模块还提供 Token 校验与用户信息查询的能力，是系统安全机制的基础部分。

### 4.2 图片上传模块

该模块负责接收来自前端的图片文件，并执行格式校验、大小校验与异常处理。上传的图片通过 FormData 传输至后端，后端在接收后将文件临时保存，并将文件信息传递给 EXIF 解析与缩略图生成模块。上传成功后，模块向前端返回图片的基础元数据与存储路径。

### 4.3 图片存储与缩略图模块

此模块负责管理图片的持久化存储，包括原图与缩略图的保存逻辑。模块采用统一的文件命名策略（如 UUID）避免重名冲突，并根据预设尺寸生成缩略图以提升前端加载效率。模块还维护图片的目录结构，确保文件读写稳定可靠。

### 4.4 EXIF 解析模块

EXIF 解析模块在图片上传后被自动调用，使用 ExifRead 或 Pillow 提取拍摄时间、分辨率、设备型号和可能的 GPS 坐标等信息。解析后的元数据被写入数据库，并作为系统查询、自动标签生成与排序的依赖数据。对于缺失 EXIF 的图片，模块需返回默认值或空字段。

### 4.5 标签管理模块

标签管理模块维护图片与标签的多对多关系。模块支持自动生成标签（如基于 EXIF 的“时间”“地点”“分辨率”标签）和用户添加的自定义标签。模块提供新增、查询与删除标签的接口，并确保同名标签不会重复创建，提高数据一致性。

### 4.6 图片展示模块

该模块负责前端的图片展示逻辑，包括缩略图列表、图片详情页以及轮播组件。后端提供图片的基础信息与缩略图路径，前端根据用户交互加载原图或进入轮播模式。模块实现移动端适配，确保小屏幕下依然具备良好展示效果。

### 4.7 图片编辑模块

图片编辑模块提供基础图像处理功能，包括裁剪、亮度调整和色调变化等。前端负责选择编辑参数与操作框，提交给后端后使用 Pillow 对原图进行处理并写回存储。模块需保留原图或覆盖新图，并返回处理后的图片信息给前端刷新展示。

### 4.8 查询模块

查询模块负责综合处理用户输入的查询条件，包括关键词、标签、拍摄时间范围、地点与分辨率等。模块使用 SQL 条件拼接实现多条件组合查询，并返回符合条件的图片列表。该模块是系统的核心功能之一，需确保查询效率与准确性。

## 5. 数据库设计

本节将此前定义的 E-R 模型转化为具体的数据库表结构，使用表格形式详细描述各表的字段、数据类型、约束与说明。

### 5.1 数据库表结构设计

以下为依据 E-R 模型设计的数据库表：

------

### **5.1.1 User 表（用户信息表）**

| 字段名        | 数据类型 | 约束                      | 说明                         |
| ------------- | -------- | ------------------------- | ---------------------------- |
| id            | INTEGER  | PRIMARY KEY AUTOINCREMENT | 用户唯一 ID                  |
| username      | TEXT     | UNIQUE NOT NULL           | 用户名，唯一，用于展示与登录 |
| email         | TEXT     | UNIQUE NOT NULL           | 邮箱，唯一，用于注册校验     |
| password_hash | TEXT     | NOT NULL                  | 加密后的密码（bcrypt）       |
| avatar_path   | TEXT     | NULL                      | 用户头像文件路径（可选）     |
| create_time   | DATETIME | DEFAULT CURRENT_TIMESTAMP | 注册时间                     |

------

### **5.1.2 Image 表（图片信息表）**

| 字段名             | 数据类型 | 约束                                               | 说明                         |
| ------------------ | -------- | -------------------------------------------------- | ---------------------------- |
| id                 | INTEGER  | PRIMARY KEY AUTOINCREMENT                          | 图片唯一 ID                  |
| user_id            | INTEGER  | NOT NULL, FOREIGN KEY(user_id) REFERENCES User(id) | 上传用户 ID                  |
| filename           | TEXT     | NOT NULL                                           | 原图存储路径                 |
| thumbnail_filename | TEXT     | NOT NULL                                           | 缩略图路径                   |
| upload_time        | DATETIME | DEFAULT CURRENT_TIMESTAMP                          | 上传时间                     |
| exif_time          | TEXT     | NULL                                               | EXIF 拍摄时间                |
| exif_location      | TEXT     | NULL                                               | 经纬度解析出的地点（城市等） |
| resolution_width   | INTEGER  | NULL                                               | 图片宽度                     |
| resolution_height  | INTEGER  | NULL                                               | 图片高度                     |
| views              | INTEGER  | DEFAULT 0                                          | 浏览次数（用于热度）         |
| likes              | INTEGER  | DEFAULT 0                                          | 点赞次数（用于热度）         |

------

### **5.1.3 Tag 表（标签表）**

| 字段名 | 数据类型 | 约束                      | 说明                                                         |
| ------ | -------- | ------------------------- | ------------------------------------------------------------ |
| id     | INTEGER  | PRIMARY KEY AUTOINCREMENT | 标签唯一 ID                                                  |
| name   | TEXT     | UNIQUE NOT NULL           | 标签名，唯一                                                 |
| type   | TEXT     | DEFAULT 'custom'          | 标签类型：'exif'（自动生成）、'ai'（AI生成）、'custom'（手动添加） |

------

### **5.1.4 ImageTag 表（图片-标签 关系表）**

| 字段名                        | 数据类型 | 约束                                       | 说明                             |
| ----------------------------- | -------- | ------------------------------------------ | -------------------------------- |
| image_id                      | INTEGER  | FOREIGN KEY(image_id) REFERENCES Image(id) | 图片 ID                          |
| tag_id                        | INTEGER  | FOREIGN KEY(tag_id) REFERENCES Tag(id)     | 标签 ID                          |
| PRIMARY KEY(image_id, tag_id) |          | 复合主键                                   | 保证同一图片不会重复关联同一标签 |

------

### **5.1.5 History 表（浏览历史表）**

（用于用户中心展示“浏览记录”）

| 字段名    | 数据类型 | 约束                                                 | 说明         |
| --------- | -------- | ---------------------------------------------------- | ------------ |
| id        | INTEGER  | PRIMARY KEY AUTOINCREMENT                            | 唯一记录 ID  |
| user_id   | INTEGER  | NOT NULL, FOREIGN KEY(user_id) REFERENCES User(id)   | 浏览用户 ID  |
| image_id  | INTEGER  | NOT NULL, FOREIGN KEY(image_id) REFERENCES Image(id) | 被浏览的图片 |
| view_time | DATETIME | DEFAULT CURRENT_TIMESTAMP                            | 浏览时间     |

------

### **5.1.6 Notification 表（通知表）**

（用于首页轮播区显示通知内容）

| 字段名       | 数据类型 | 约束                      | 说明             |
| ------------ | -------- | ------------------------- | ---------------- |
| id           | INTEGER  | PRIMARY KEY AUTOINCREMENT | 通知唯一 ID      |
| title        | TEXT     | NOT NULL                  | 通知标题         |
| content      | TEXT     | NOT NULL                  | 通知正文         |
| image_path   | TEXT     | NULL                      | 通知配图（可选） |
| publish_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 发布时间         |

------

### 5.2 实体之间的关系总结

#### **User — Image：一对多（1:N）**

- 每个用户可以上传多张图片。
- 每张图片只能属于一个用户。

#### **Image — Tag：多对多（M:N）**

- 通过 ImageTag 实现。
- 支持图片拥有多个标签，也支持标签复用。

#### **Image — ExifInfo：一对一（可选）**

- 当前合并在 Image 表中。
- 若拆分，则每张图片对应一条 EXIF 记录。

------

### 5.3 E-R 模型的小结

该 E-R 模型重点在于：

- 保持结构**简洁**，便于课程要求的 SQLite 数据库实现。
- 支持图片管理的核心需求：**上传、展示、查询、标签分类**。
- 支持**自动扩展**至 AI 标签、更多 EXIF 字段或用户社交功能。

模型结构清晰、关系明确，可支持系统的全部核心功能与后续增强功能。

### 5.4 数据库初始化

将在提交中附带 `init_db.sql` 文件。

------

## 6. API 接口设计

### 6.1 用户相关

- POST `/api/register`
- POST `/api/login`
- GET `/api/user`（需要 Token）

### 6.2 图片相关

- POST `/api/upload`
- GET `/api/images`
- GET `/api/image/{id}`
- DELETE `/api/image/{id}`
- POST `/api/image/{id}/edit`

### 6.3 标签与查询

- GET `/api/tags`
- GET `/api/search?keyword=&tag=&date=`

### 6.4 AI 与 MCP（可选）

- POST `/api/ai/analyze`
- POST `/api/mcp/query`

------

## 7. 流程设计

### 7.1 用户注册流程

1. 用户在前端填写信息提交表单。
2. 后端检查唯一性并保存用户信息。
3. 返回注册成功状态。

### 7.2 图片上传流程

1. 前端表单发送图片文件。
2. 后端保存文件并解析 EXIF。
3. 后端生成缩略图。
4. 记录写入数据库。
5. 返回图片信息。

### 7.3 查询流程

1. 用户选择查询条件。
2. 前端发送 GET 请求至 `/api/search`。
3. 后端根据条件组合 SQL 查询。
4. 返回符合条件的图片列表。

------

## 8. 部署设计

系统通过 Docker Compose 一键部署：

- Flask 服务运行在 `backend` 容器中。
- React 构建后的静态文件由 `nginx` 容器托管。
- SQLite 数据文件存放于挂载卷中。

示例文件结构：

```
/project
  /frontend
  /backend
  docker-compose.yml
  Dockerfile.backend
  Dockerfile.frontend
```

------

## 9. **工作流程与日程目标设计**

### **9.1整体开发流程**

项目采用 **迭代式开发流程（Iterative Development）**，每个阶段包含“设计 → 实现 → 测试 → 调整”，以保证功能稳定和进度可控。

主要流程如下：

1. **需求分析阶段**：明确功能需求、用户流程与技术路线。
2. **系统设计阶段**：完成架构设计、数据库设计、接口设计、模块划分。
3. **后端基础实现**：完成 Flask 结构搭建与用户模块 / 鉴权。
4. **前端基础实现**：搭建 React 结构，完成登录注册页面与 Token 流程。
5. **核心功能开发**：图片上传、存储、缩略图生成、EXIF 解析。
6. **增强功能开发**：搜索、标签管理、用户中心、历史记录、编辑功能等。
7. **联调与测试阶段**：前后端联调、修复功能 Bug 和适配问题。
8. **部署与提交阶段**：Docker 部署、文档整理、录制演示视频并提交成果。

------

### **9.2. 日程目标计划（建议排期）**

| **周次**    | **工作内容**                                | **目标成果**                 |
| ----------- | ------------------------------------------- | ---------------------------- |
| **第 1 周** | 需求分析、系统架构、技术选型                | 完成设计文档前 3 章草稿      |
| **第 2 周** | 数据库设计、API 设计、搭建 Flask 框架       | 初版数据库结构、后端基础目录 |
| **第 3 周** | 用户注册、登录、JWT 鉴权；前端登录/注册界面 | 可登录并进入主页面的初版系统 |
| **第 4 周** | 图片上传、存储、缩略图生成、EXIF 解析       | 后端完整图片处理流程可用     |
| **第 5 周** | 图片展示页面、排序、缩略图加载、基础搜索    | 主页面展示功能完成           |
| **第 6 周** | 用户中心、浏览记录、上传管理、编辑功能      | 核心功能开发完成             |
| **第 7 周** | 前后端联调、测试、性能优化、手机端适配      | 系统稳定运行，完成测试       |
| **第 8 周** | Docker 部署、录制演示视频、整理提交材料     | 完整可交付系统               |

------


### **9.3. 阶段性验收目标**

- **阶段 1（第 3 周）**：登录模块、Token 机制、基础界面完成
- **阶段 2（第 5 周）**：图片上传 → 处理 → 展示流程可用
- **阶段 3（第 7 周）**：所有核心功能上线，完成初步测试
- **阶段 4（第 9 周）**：完成部署、文档、视频，整体提交

## 10  结语  

本设计文档详细展示了图片管理系统的设计思想与技术方案。系统采用 React + Flask + SQLite 架构，模块清晰、结构 简单，同时具备良好扩展性，可继续集成 AI 标签识别、MCP 对话检索等增强功能